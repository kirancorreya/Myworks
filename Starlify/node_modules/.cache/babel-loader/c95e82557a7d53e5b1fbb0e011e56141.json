{"ast":null,"code":"var _jsxFileName = \"/Users/kirancorreya/Site/Starlify/src/pages/dashboard/graph/Graph.js\";\nimport React, { Component } from 'react';\nimport * as d3 from 'd3';\nimport { connect } from 'react-redux';\n\nclass Graph extends Component {\n  constructor() {\n    super();\n\n    this.fetchSystems = () => {\n      fetch(process.env.REACT_APP_API + \"model/6c161cbe-0d86-413b-8ea1-0bbb2ba9e5d6\").then(res => res.json()).then(result => {\n        var systems = result.systems;\n        systems.forEach(function (data, key) {\n          var syskey = key;\n\n          if (data.references) {\n            data.references.forEach(function (reference, refkey) {\n              fetch(process.env.REACT_APP_API + \"model/6c161cbe-0d86-413b-8ea1-0bbb2ba9e5d6/reference/\" + reference.id).then(res => res.json()).then(result => {\n                systems[syskey].references[refkey].service = [];\n                systems[syskey].references[refkey].service = result.service;\n              }, error => {\n                return error;\n              });\n            });\n          }\n        });\n        return systems;\n      }).then(data => {\n        setTimeout(() => {\n          this.setState({\n            systems: data\n          });\n        }, 2000);\n      });\n    };\n\n    this.buildForceGraph = systems => {\n      new Promise(function (resolve, reject) {\n        var items = [];\n        items[\"nodes\"] = [];\n        items[\"links\"] = [];\n        var i = 0;\n        systems.forEach(function (data) {\n          var sysid = data.id;\n          items[\"nodes\"][i] = {\n            \"id\": sysid,\n            \"name\": data.name || \"System\",\n            \"type\": \"system\",\n            \"radius\": 15\n          };\n\n          if (data.services) {\n            data.services.forEach(function (service) {\n              var j = ++i;\n              items[\"nodes\"][j] = {\n                \"id\": service.id,\n                name: service.name || \"Service\",\n                \"type\": \"service\",\n                \"radius\": 5\n              };\n              items[\"links\"].push({\n                \"source\": sysid,\n                \"target\": service.id,\n                \"type\": \"service\"\n              });\n            });\n          }\n\n          if (data.references) {\n            data.references.forEach(function (reference) {\n              items[\"links\"].push({\n                \"source\": sysid,\n                \"target\": reference.service.id,\n                \"type\": \"reference\"\n              });\n            });\n          }\n\n          i++;\n        });\n        resolve(items);\n      }).then(function (items) {\n        const width = window.innerWidth,\n              height = window.innerHeight - 100;\n        const zoom = d3.zoom().scaleExtent([0.5, 6]).on(\"zoom\", zoomed);\n        var svg = d3.select(\".forcegraph\").append(\"svg\").attr(\"width\", width).attr(\"height\", height).call(zoom).append(\"g\").attr(\"transform\", \"translate(0,0)\");\n        svg.append('defs').append('marker').attr('id', 'service').attr('viewBox', '-5 -5 20 20').attr('refX', 8).attr('refY', 0).attr('orient', 'auto').attr('markerWidth', 25).attr('markerHeight', 25).attr('xoverflow', 'visible').append('svg:path').attr('d', 'M -5 -2 L 0 0 L -5 2 z').attr('fill', '#fff').style('stroke', 'none');\n        var simulation = d3.forceSimulation().force(\"link\", d3.forceLink().id(function (d, i) {\n          return d.id;\n        }).distance(function (d) {\n          return d.type === \"reference\" ? 100 : 10;\n        })).force(\"charge\", d3.forceManyBody().strength(-250)).force('gravity', d3.forceRadial(0, 0)).force('x', d3.forceX().strength(0.01)).force('y', d3.forceY().strength(0.01)).force('collide', d3.forceCollide(0)).force(\"center\", d3.forceCenter(width / 2, height / 2));\n        var links = svg.selectAll(\".link\").data(items.links).enter().append(\"line\").attr(\"class\", \"link\");\n        var nodes = svg.selectAll(\".node\").data(items.nodes).enter().append(\"g\").attr(\"class\", \"node\").call(d3.drag().on(\"start\", dragstarted).on(\"drag\", dragged).on(\"end\", dragended));\n        var circle = nodes.append(\"circle\");\n        var label = nodes.append(\"text\").attr(\"dy\", \".35em\").attr(\"class\", function (d) {\n          return d.type;\n        }).text(function (d) {\n          return d.name;\n        });\n        simulation.nodes(items.nodes).on(\"tick\", tick);\n        simulation.force(\"link\").links(items.links);\n\n        function tick() {\n          links.attr(\"x1\", function (d) {\n            return d.source.x;\n          }).attr(\"y1\", function (d) {\n            return d.source.y;\n          }).attr(\"x2\", function (d) {\n            return d.target.x;\n          }).attr(\"y2\", function (d) {\n            return d.target.y;\n          }).attr(\"marker-end\", function (d) {\n            return d.type === \"reference\" ? \"url(#service)\" : \"\";\n          });\n          circle.attr(\"id\", function (d) {\n            return \"graph_\" + d.id;\n          }).attr(\"cx\", function (d) {\n            return d.x;\n          }).attr(\"cy\", function (d) {\n            return d.y;\n          }).attr(\"class\", function (d) {\n            return d.type;\n          }).attr(\"r\", weightRadius);\n          label.attr(\"x\", function (d) {\n            return d.x;\n          }).attr(\"y\", function (d) {\n            return d.y;\n          });\n        }\n\n        function weightRadius(d) {\n          var r = d.radius;\n          return r;\n        }\n\n        function zoomed() {\n          svg.attr('transform', 'translate(' + d3.event.transform.x + ',' + d3.event.transform.y + ') scale(' + d3.event.transform.k + ')');\n        }\n\n        function dragstarted(d) {\n          if (!d3.event.active) simulation.alphaTarget(0.3).restart();\n          d.fx = d.x;\n          d.fy = d.y;\n        }\n\n        function dragged(d) {\n          d.fx = d3.event.x;\n          d.fy = d3.event.y;\n        }\n\n        function dragended(d) {\n          if (!d3.event.active) simulation.alphaTarget(0);\n          d.fx = null;\n          d.fy = null;\n        }\n      });\n    };\n\n    this.fetchSystems = this.fetchSystems.bind(this);\n    this.buildForceGraph = this.buildForceGraph.bind(this);\n    this.state = {\n      load_graph: false,\n      systems: []\n    };\n  }\n\n  componentWillMount() {\n    this.fetchSystems();\n  }\n\n  componentDidUpdate() {\n    if (this.state.load_graph === false) {\n      if (this.state.systems.length !== 0) this.buildForceGraph(this.state.systems);\n      this.setState({\n        load_graph: true\n      });\n    }\n\n    var activeSys = document.getElementById(\"graph_\" + this.props.activeSystem);\n\n    if (activeSys !== null) {\n      var cols = document.getElementsByClassName('system');\n\n      for (var i = 0; i < cols.length; i++) {\n        cols[i].style.fill = '';\n      }\n\n      activeSys.setAttribute(\"style\", \"fill:#e8455c\");\n    }\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 220\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"forcegraph\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 221\n      },\n      __self: this\n    }));\n  }\n\n}\n\nfunction mapStateToProps(state) {\n  return {\n    activeSystem: state.activeSystem\n  };\n}\n\nexport default connect(mapStateToProps)(Graph);","map":{"version":3,"sources":["/Users/kirancorreya/Site/Starlify/src/pages/dashboard/graph/Graph.js"],"names":["React","Component","d3","connect","Graph","constructor","fetchSystems","fetch","process","env","REACT_APP_API","then","res","json","result","systems","forEach","data","key","syskey","references","reference","refkey","id","service","error","setTimeout","setState","buildForceGraph","Promise","resolve","reject","items","i","sysid","name","services","j","push","width","window","innerWidth","height","innerHeight","zoom","scaleExtent","on","zoomed","svg","select","append","attr","call","style","simulation","forceSimulation","force","forceLink","d","distance","type","forceManyBody","strength","forceRadial","forceX","forceY","forceCollide","forceCenter","links","selectAll","enter","nodes","drag","dragstarted","dragged","dragended","circle","label","text","tick","source","x","y","target","weightRadius","r","radius","event","transform","k","active","alphaTarget","restart","fx","fy","bind","state","load_graph","componentWillMount","componentDidUpdate","length","activeSys","document","getElementById","props","activeSystem","cols","getElementsByClassName","fill","setAttribute","render","mapStateToProps"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,OAAO,KAAKC,EAAZ,MAAoB,IAApB;AACA,SAASC,OAAT,QAAwB,aAAxB;;AAEA,MAAMC,KAAN,SAAoBH,SAApB,CAA8B;AAE5BI,EAAAA,WAAW,GAAE;AACX;;AADW,SAUbC,YAVa,GAUE,MAAM;AACnBC,MAAAA,KAAK,CAACC,OAAO,CAACC,GAAR,CAAYC,aAAZ,GAA4B,4CAA7B,CAAL,CACCC,IADD,CACMC,GAAG,IAAIA,GAAG,CAACC,IAAJ,EADb,EAECF,IAFD,CAEOG,MAAD,IAAY;AAChB,YAAIC,OAAO,GAAGD,MAAM,CAACC,OAArB;AACAA,QAAAA,OAAO,CAACC,OAAR,CAAgB,UAASC,IAAT,EAAeC,GAAf,EAAoB;AAClC,cAAIC,MAAM,GAAGD,GAAb;;AACA,cAAID,IAAI,CAACG,UAAT,EAAoB;AAClBH,YAAAA,IAAI,CAACG,UAAL,CAAgBJ,OAAhB,CAAwB,UAASK,SAAT,EAAoBC,MAApB,EAA2B;AACjDf,cAAAA,KAAK,CAACC,OAAO,CAACC,GAAR,CAAYC,aAAZ,GAA4B,uDAA5B,GAAsFW,SAAS,CAACE,EAAjG,CAAL,CACCZ,IADD,CACMC,GAAG,IAAIA,GAAG,CAACC,IAAJ,EADb,EAECF,IAFD,CAEOG,MAAD,IAAY;AAChBC,gBAAAA,OAAO,CAACI,MAAD,CAAP,CAAgBC,UAAhB,CAA2BE,MAA3B,EAAmCE,OAAnC,GAA6C,EAA7C;AACAT,gBAAAA,OAAO,CAACI,MAAD,CAAP,CAAgBC,UAAhB,CAA2BE,MAA3B,EAAmCE,OAAnC,GAA6CV,MAAM,CAACU,OAApD;AACD,eALD,EAKIC,KAAD,IAAW;AACZ,uBAAOA,KAAP;AACD,eAPD;AAQD,aATD;AAUD;AACF,SAdD;AAeA,eAAOV,OAAP;AACD,OApBD,EAqBCJ,IArBD,CAqBOM,IAAD,IAAU;AACdS,QAAAA,UAAU,CAAC,MAAM;AACf,eAAKC,QAAL,CAAc;AAACZ,YAAAA,OAAO,EAAEE;AAAV,WAAd;AACD,SAFS,EAEP,IAFO,CAAV;AAGD,OAzBD;AA0BD,KArCY;;AAAA,SAuCbW,eAvCa,GAuCMb,OAAD,IAAa;AAC7B,UAAIc,OAAJ,CAAY,UAASC,OAAT,EAAkBC,MAAlB,EAA0B;AAClC,YAAIC,KAAK,GAAG,EAAZ;AACAA,QAAAA,KAAK,CAAC,OAAD,CAAL,GAAiB,EAAjB;AACAA,QAAAA,KAAK,CAAC,OAAD,CAAL,GAAiB,EAAjB;AACA,YAAIC,CAAC,GAAG,CAAR;AAEAlB,QAAAA,OAAO,CAACC,OAAR,CAAgB,UAASC,IAAT,EAAe;AAC7B,cAAIiB,KAAK,GAAGjB,IAAI,CAACM,EAAjB;AACAS,UAAAA,KAAK,CAAC,OAAD,CAAL,CAAeC,CAAf,IAAoB;AAAE,kBAAMC,KAAR;AAAe,oBAAQjB,IAAI,CAACkB,IAAL,IAAc,QAArC;AAA+C,oBAAQ,QAAvD;AAAiE,sBAAU;AAA3E,WAApB;;AACA,cAAIlB,IAAI,CAACmB,QAAT,EAAkB;AAChBnB,YAAAA,IAAI,CAACmB,QAAL,CAAcpB,OAAd,CAAsB,UAASQ,OAAT,EAAiB;AACrC,kBAAIa,CAAC,GAAG,EAAEJ,CAAV;AACAD,cAAAA,KAAK,CAAC,OAAD,CAAL,CAAeK,CAAf,IAAoB;AAAE,sBAAMb,OAAO,CAACD,EAAhB;AAAoBY,gBAAAA,IAAI,EAAEX,OAAO,CAACW,IAAR,IAAgB,SAA1C;AAAqD,wBAAQ,SAA7D;AAAwE,0BAAU;AAAlF,eAApB;AACAH,cAAAA,KAAK,CAAC,OAAD,CAAL,CAAeM,IAAf,CAAoB;AAAC,0BAAUJ,KAAX;AAAkB,0BAAUV,OAAO,CAACD,EAApC;AAAwC,wBAAQ;AAAhD,eAApB;AACD,aAJD;AAKD;;AAED,cAAIN,IAAI,CAACG,UAAT,EAAoB;AAClBH,YAAAA,IAAI,CAACG,UAAL,CAAgBJ,OAAhB,CAAwB,UAASK,SAAT,EAAmB;AACzCW,cAAAA,KAAK,CAAC,OAAD,CAAL,CAAeM,IAAf,CAAoB;AAAC,0BAAUJ,KAAX;AAAkB,0BAAUb,SAAS,CAACG,OAAV,CAAkBD,EAA9C;AAAkD,wBAAQ;AAA1D,eAApB;AACD,aAFD;AAGD;;AAEDU,UAAAA,CAAC;AACF,SAlBD;AAoBAH,QAAAA,OAAO,CAACE,KAAD,CAAP;AAED,OA5BH,EA4BKrB,IA5BL,CA4BU,UAASqB,KAAT,EAAgB;AACtB,cAAMO,KAAK,GAAGC,MAAM,CAACC,UAArB;AAAA,cACEC,MAAM,GAAGF,MAAM,CAACG,WAAP,GAAqB,GADhC;AAGA,cAAMC,IAAI,GAAG1C,EAAE,CAAC0C,IAAH,GACAC,WADA,CACY,CAAC,GAAD,EAAM,CAAN,CADZ,EAEAC,EAFA,CAEG,MAFH,EAEWC,MAFX,CAAb;AAGA,YAAIC,GAAG,GAAG9C,EAAE,CAAC+C,MAAH,CAAU,aAAV,EAAyBC,MAAzB,CAAgC,KAAhC,EACLC,IADK,CACA,OADA,EACSZ,KADT,EAELY,IAFK,CAEA,QAFA,EAEUT,MAFV,EAGLU,IAHK,CAGAR,IAHA,EAILM,MAJK,CAIE,GAJF,EAKLC,IALK,CAKA,WALA,EAKa,gBALb,CAAV;AAOEH,QAAAA,GAAG,CAACE,MAAJ,CAAW,MAAX,EAAmBA,MAAnB,CAA0B,QAA1B,EACGC,IADH,CACQ,IADR,EACc,SADd,EAEGA,IAFH,CAEQ,SAFR,EAEmB,aAFnB,EAGGA,IAHH,CAGQ,MAHR,EAGgB,CAHhB,EAIGA,IAJH,CAIQ,MAJR,EAIgB,CAJhB,EAKGA,IALH,CAKQ,QALR,EAKkB,MALlB,EAMGA,IANH,CAMQ,aANR,EAMuB,EANvB,EAOGA,IAPH,CAOQ,cAPR,EAOwB,EAPxB,EAQGA,IARH,CAQQ,WARR,EAQqB,SARrB,EASGD,MATH,CASU,UATV,EAUGC,IAVH,CAUQ,GAVR,EAUa,wBAVb,EAWGA,IAXH,CAWQ,MAXR,EAWgB,MAXhB,EAYGE,KAZH,CAYS,QAZT,EAYkB,MAZlB;AAcF,YAAIC,UAAU,GAAGpD,EAAE,CAACqD,eAAH,GACdC,KADc,CACR,MADQ,EACAtD,EAAE,CAACuD,SAAH,GAAelC,EAAf,CAAkB,UAASmC,CAAT,EAAWzB,CAAX,EAAc;AAC7C,iBAAOyB,CAAC,CAACnC,EAAT;AACD,SAFc,EAGdoC,QAHc,CAGL,UAASD,CAAT,EAAY;AACpB,iBAAOA,CAAC,CAACE,IAAF,KAAW,WAAX,GAAyB,GAAzB,GAA+B,EAAtC;AACD,SALc,CADA,EAOdJ,KAPc,CAOR,QAPQ,EAOEtD,EAAE,CAAC2D,aAAH,GAAmBC,QAAnB,CAA4B,CAAC,GAA7B,CAPF,EAQdN,KARc,CAQR,SARQ,EAQGtD,EAAE,CAAC6D,WAAH,CAAe,CAAf,EAAkB,CAAlB,CARH,EASdP,KATc,CASR,GATQ,EASHtD,EAAE,CAAC8D,MAAH,GAAYF,QAAZ,CAAqB,IAArB,CATG,EAUdN,KAVc,CAUR,GAVQ,EAUHtD,EAAE,CAAC+D,MAAH,GAAYH,QAAZ,CAAqB,IAArB,CAVG,EAWdN,KAXc,CAWR,SAXQ,EAWGtD,EAAE,CAACgE,YAAH,CAAgB,CAAhB,CAXH,EAYdV,KAZc,CAYR,QAZQ,EAYEtD,EAAE,CAACiE,WAAH,CAAe5B,KAAK,GAAG,CAAvB,EAA0BG,MAAM,GAAG,CAAnC,CAZF,CAAjB;AAcA,YAAI0B,KAAK,GAAGpB,GAAG,CAACqB,SAAJ,CAAc,OAAd,EACTpD,IADS,CACJe,KAAK,CAACoC,KADF,EAETE,KAFS,GAEDpB,MAFC,CAEM,MAFN,EAGTC,IAHS,CAGJ,OAHI,EAGK,MAHL,CAAZ;AAKA,YAAIoB,KAAK,GAAGvB,GAAG,CAACqB,SAAJ,CAAc,OAAd,EACTpD,IADS,CACJe,KAAK,CAACuC,KADF,EAETD,KAFS,GAEDpB,MAFC,CAEM,GAFN,EAGTC,IAHS,CAGJ,OAHI,EAGK,MAHL,EAITC,IAJS,CAIJlD,EAAE,CAACsE,IAAH,GACH1B,EADG,CACA,OADA,EACS2B,WADT,EAEH3B,EAFG,CAEA,MAFA,EAEQ4B,OAFR,EAGH5B,EAHG,CAGA,KAHA,EAGO6B,SAHP,CAJI,CAAZ;AAUA,YAAIC,MAAM,GAAGL,KAAK,CAACrB,MAAN,CAAa,QAAb,CAAb;AAEA,YAAI2B,KAAK,GAAGN,KAAK,CAACrB,MAAN,CAAa,MAAb,EACTC,IADS,CACJ,IADI,EACE,OADF,EAETA,IAFS,CAEJ,OAFI,EAEK,UAASO,CAAT,EAAY;AAAE,iBAAOA,CAAC,CAACE,IAAT;AAAgB,SAFnC,EAGTkB,IAHS,CAGJ,UAASpB,CAAT,EAAY;AAAE,iBAAOA,CAAC,CAACvB,IAAT;AAAgB,SAH1B,CAAZ;AAKAmB,QAAAA,UAAU,CACPiB,KADH,CACSvC,KAAK,CAACuC,KADf,EAEGzB,EAFH,CAEM,MAFN,EAEciC,IAFd;AAIAzB,QAAAA,UAAU,CACPE,KADH,CACS,MADT,EAEGY,KAFH,CAESpC,KAAK,CAACoC,KAFf;;AAIA,iBAASW,IAAT,GAAgB;AACdX,UAAAA,KAAK,CACFjB,IADH,CACQ,IADR,EACc,UAAUO,CAAV,EAAa;AAAE,mBAAOA,CAAC,CAACsB,MAAF,CAASC,CAAhB;AAAoB,WADjD,EAEG9B,IAFH,CAEQ,IAFR,EAEc,UAAUO,CAAV,EAAa;AAAE,mBAAOA,CAAC,CAACsB,MAAF,CAASE,CAAhB;AAAoB,WAFjD,EAGG/B,IAHH,CAGQ,IAHR,EAGc,UAAUO,CAAV,EAAa;AAAE,mBAAOA,CAAC,CAACyB,MAAF,CAASF,CAAhB;AAAoB,WAHjD,EAIG9B,IAJH,CAIQ,IAJR,EAIc,UAAUO,CAAV,EAAa;AAAE,mBAAOA,CAAC,CAACyB,MAAF,CAASD,CAAhB;AAAoB,WAJjD,EAKG/B,IALH,CAKQ,YALR,EAKsB,UAASO,CAAT,EAAY;AAC9B,mBAAOA,CAAC,CAACE,IAAF,KAAW,WAAX,GAAyB,eAAzB,GAA2C,EAAlD;AACD,WAPH;AASAgB,UAAAA,MAAM,CACHzB,IADH,CACQ,IADR,EACc,UAASO,CAAT,EAAY;AAAE,mBAAO,WAASA,CAAC,CAACnC,EAAlB;AAAuB,WADnD,EAEG4B,IAFH,CAEQ,IAFR,EAEc,UAASO,CAAT,EAAY;AAAE,mBAAOA,CAAC,CAACuB,CAAT;AAAa,WAFzC,EAGG9B,IAHH,CAGQ,IAHR,EAGc,UAASO,CAAT,EAAY;AAAE,mBAAOA,CAAC,CAACwB,CAAT;AAAa,WAHzC,EAIG/B,IAJH,CAIQ,OAJR,EAIiB,UAASO,CAAT,EAAY;AAAE,mBAAOA,CAAC,CAACE,IAAT;AAAgB,WAJ/C,EAKGT,IALH,CAKQ,GALR,EAKaiC,YALb;AAOAP,UAAAA,KAAK,CACF1B,IADH,CACQ,GADR,EACa,UAASO,CAAT,EAAY;AAAE,mBAAOA,CAAC,CAACuB,CAAT;AAAa,WADxC,EAEG9B,IAFH,CAEQ,GAFR,EAEa,UAASO,CAAT,EAAY;AAAE,mBAAOA,CAAC,CAACwB,CAAT;AAAa,WAFxC;AAGD;;AAED,iBAASE,YAAT,CAAsB1B,CAAtB,EAAyB;AACvB,cAAI2B,CAAC,GAAG3B,CAAC,CAAC4B,MAAV;AACA,iBAAOD,CAAP;AACD;;AAED,iBAAStC,MAAT,GAAkB;AACdC,UAAAA,GAAG,CAACG,IAAJ,CAAS,WAAT,EAAsB,eAAejD,EAAE,CAACqF,KAAH,CAASC,SAAT,CAAmBP,CAAlC,GAAsC,GAAtC,GAA4C/E,EAAE,CAACqF,KAAH,CAASC,SAAT,CAAmBN,CAA/D,GAAmE,UAAnE,GAAgFhF,EAAE,CAACqF,KAAH,CAASC,SAAT,CAAmBC,CAAnG,GAAuG,GAA7H;AACH;;AAED,iBAAShB,WAAT,CAAqBf,CAArB,EAAwB;AACpB,cAAI,CAACxD,EAAE,CAACqF,KAAH,CAASG,MAAd,EAAsBpC,UAAU,CAACqC,WAAX,CAAuB,GAAvB,EAA4BC,OAA5B;AACtBlC,UAAAA,CAAC,CAACmC,EAAF,GAAOnC,CAAC,CAACuB,CAAT;AACAvB,UAAAA,CAAC,CAACoC,EAAF,GAAOpC,CAAC,CAACwB,CAAT;AACH;;AAED,iBAASR,OAAT,CAAiBhB,CAAjB,EAAoB;AAChBA,UAAAA,CAAC,CAACmC,EAAF,GAAO3F,EAAE,CAACqF,KAAH,CAASN,CAAhB;AACAvB,UAAAA,CAAC,CAACoC,EAAF,GAAO5F,EAAE,CAACqF,KAAH,CAASL,CAAhB;AACH;;AAED,iBAASP,SAAT,CAAmBjB,CAAnB,EAAsB;AAClB,cAAI,CAACxD,EAAE,CAACqF,KAAH,CAASG,MAAd,EAAsBpC,UAAU,CAACqC,WAAX,CAAuB,CAAvB;AACtBjC,UAAAA,CAAC,CAACmC,EAAF,GAAO,IAAP;AACAnC,UAAAA,CAAC,CAACoC,EAAF,GAAO,IAAP;AACH;AAEF,OApJH;AAsJD,KA9LY;;AAEX,SAAKxF,YAAL,GAAoB,KAAKA,YAAL,CAAkByF,IAAlB,CAAuB,IAAvB,CAApB;AACA,SAAKnE,eAAL,GAAuB,KAAKA,eAAL,CAAqBmE,IAArB,CAA0B,IAA1B,CAAvB;AACA,SAAKC,KAAL,GAAa;AACXC,MAAAA,UAAU,EAAE,KADD;AAEXlF,MAAAA,OAAO,EAAE;AAFE,KAAb;AAID;;AAwLDmF,EAAAA,kBAAkB,GAAE;AAClB,SAAK5F,YAAL;AACD;;AAED6F,EAAAA,kBAAkB,GAAE;AAClB,QAAG,KAAKH,KAAL,CAAWC,UAAX,KAA0B,KAA7B,EAAmC;AACjC,UAAG,KAAKD,KAAL,CAAWjF,OAAX,CAAmBqF,MAAnB,KAA8B,CAAjC,EAAoC,KAAKxE,eAAL,CAAqB,KAAKoE,KAAL,CAAWjF,OAAhC;AACpC,WAAKY,QAAL,CAAc;AAACsE,QAAAA,UAAU,EAAE;AAAb,OAAd;AACD;;AACD,QAAII,SAAS,GAAGC,QAAQ,CAACC,cAAT,CAAwB,WAAS,KAAKC,KAAL,CAAWC,YAA5C,CAAhB;;AACA,QAAGJ,SAAS,KAAK,IAAjB,EAAsB;AACpB,UAAIK,IAAI,GAAGJ,QAAQ,CAACK,sBAAT,CAAgC,QAAhC,CAAX;;AACA,WAAI,IAAI1E,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGyE,IAAI,CAACN,MAAxB,EAAgCnE,CAAC,EAAjC,EAAqC;AACnCyE,QAAAA,IAAI,CAACzE,CAAD,CAAJ,CAAQoB,KAAR,CAAcuD,IAAd,GAAqB,EAArB;AACD;;AACDP,MAAAA,SAAS,CAACQ,YAAV,CAAuB,OAAvB,EAAgC,cAAhC;AACD;AACF;;AAEDC,EAAAA,MAAM,GAAG;AACP,WACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE;AAAK,MAAA,SAAS,EAAC,YAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,CADF;AAMD;;AA5N2B;;AA+N9B,SAASC,eAAT,CAAyBf,KAAzB,EAA+B;AAC7B,SAAM;AACJS,IAAAA,YAAY,EAAET,KAAK,CAACS;AADhB,GAAN;AAGD;;AAED,eAAetG,OAAO,CAAC4G,eAAD,CAAP,CAAyB3G,KAAzB,CAAf","sourcesContent":["import React, { Component } from 'react';\nimport * as d3 from 'd3';\nimport { connect } from 'react-redux';\n\nclass Graph extends Component {\n\n  constructor(){\n    super();\n    this.fetchSystems = this.fetchSystems.bind(this);\n    this.buildForceGraph = this.buildForceGraph.bind(this);\n    this.state = {\n      load_graph: false,\n      systems: []\n    }\n  }\n\n  fetchSystems = () => {\n    fetch(process.env.REACT_APP_API + \"model/6c161cbe-0d86-413b-8ea1-0bbb2ba9e5d6\")\n    .then(res => res.json())\n    .then((result) => {\n      var systems = result.systems;\n      systems.forEach(function(data, key) {\n        var syskey = key;\n        if (data.references){\n          data.references.forEach(function(reference, refkey){\n            fetch(process.env.REACT_APP_API + \"model/6c161cbe-0d86-413b-8ea1-0bbb2ba9e5d6/reference/\" + reference.id)\n            .then(res => res.json())\n            .then((result) => {\n              systems[syskey].references[refkey].service = [];\n              systems[syskey].references[refkey].service = result.service;\n            }, (error) => {\n              return error;\n            })\n          })\n        }\n      });\n      return systems;\n    })\n    .then((data) => {\n      setTimeout(() => {\n        this.setState({systems: data});\n      }, 2000);\n    })\n  }\n\n  buildForceGraph = (systems) => {\n    new Promise(function(resolve, reject) {\n        var items = [];\n        items[\"nodes\"] = [];\n        items[\"links\"] = [];\n        var i = 0;\n\n        systems.forEach(function(data) {\n          var sysid = data.id;\n          items[\"nodes\"][i] = { \"id\": sysid, \"name\": data.name  || \"System\", \"type\": \"system\", \"radius\": 15 };\n          if (data.services){\n            data.services.forEach(function(service){\n              var j = ++i;\n              items[\"nodes\"][j] = { \"id\": service.id, name: service.name || \"Service\", \"type\": \"service\", \"radius\": 5 };\n              items[\"links\"].push({\"source\": sysid, \"target\": service.id, \"type\": \"service\"});\n            })\n          }\n    \n          if (data.references){\n            data.references.forEach(function(reference){\n              items[\"links\"].push({\"source\": sysid, \"target\": reference.service.id, \"type\": \"reference\"});\n            })\n          }\n    \n          i++;\n        });\n\n        resolve(items);\n      \n      }).then(function(items) {\n        const width = window.innerWidth,\n          height = window.innerHeight - 100;\n\n        const zoom = d3.zoom()\n                    .scaleExtent([0.5, 6])\n                    .on(\"zoom\", zoomed);\n        var svg = d3.select(\".forcegraph\").append(\"svg\")\n            .attr(\"width\", width)\n            .attr(\"height\", height)\n            .call(zoom)\n            .append(\"g\")\n            .attr(\"transform\", \"translate(0,0)\");\n\n          svg.append('defs').append('marker')\n            .attr('id', 'service')\n            .attr('viewBox', '-5 -5 20 20')\n            .attr('refX', 8)\n            .attr('refY', 0)\n            .attr('orient', 'auto')\n            .attr('markerWidth', 25)\n            .attr('markerHeight', 25)\n            .attr('xoverflow', 'visible')\n            .append('svg:path')\n            .attr('d', 'M -5 -2 L 0 0 L -5 2 z')\n            .attr('fill', '#fff')\n            .style('stroke','none');\n\n        var simulation = d3.forceSimulation()\n          .force(\"link\", d3.forceLink().id(function(d,i) {\n            return d.id;\n          })\n          .distance(function(d) {\n            return d.type === \"reference\" ? 100 : 10;\n          }))\n          .force(\"charge\", d3.forceManyBody().strength(-250 ))\n          .force('gravity', d3.forceRadial(0, 0))\n          .force('x', d3.forceX().strength(0.01))\n          .force('y', d3.forceY().strength(0.01))\n          .force('collide', d3.forceCollide(0))\n          .force(\"center\", d3.forceCenter(width / 2, height / 2));\n\n        var links = svg.selectAll(\".link\")\n          .data(items.links)\n          .enter().append(\"line\")\n          .attr(\"class\", \"link\");\n        \n        var nodes = svg.selectAll(\".node\")\n          .data(items.nodes)\n          .enter().append(\"g\")\n          .attr(\"class\", \"node\")\n          .call(d3.drag()\n            .on(\"start\", dragstarted)\n            .on(\"drag\", dragged)\n            .on(\"end\", dragended)\n          );\n\n        var circle = nodes.append(\"circle\");\n\n        var label = nodes.append(\"text\")\n          .attr(\"dy\", \".35em\")\n          .attr(\"class\", function(d) { return d.type; })\n          .text(function(d) { return d.name; });\n\n        simulation\n          .nodes(items.nodes)\n          .on(\"tick\", tick);\n\n        simulation\n          .force(\"link\")\n          .links(items.links);\n\n        function tick() {\n          links\n            .attr(\"x1\", function (d) { return d.source.x; })\n            .attr(\"y1\", function (d) { return d.source.y; })\n            .attr(\"x2\", function (d) { return d.target.x; })\n            .attr(\"y2\", function (d) { return d.target.y; })\n            .attr(\"marker-end\", function(d) {\n              return d.type === \"reference\" ? \"url(#service)\" : \"\";\n            });\n\n          circle\n            .attr(\"id\", function(d) { return \"graph_\"+d.id; })\n            .attr(\"cx\", function(d) { return d.x; })\n            .attr(\"cy\", function(d) { return d.y; })\n            .attr(\"class\", function(d) { return d.type; })\n            .attr(\"r\", weightRadius);\n\n          label\n            .attr(\"x\", function(d) { return d.x; })\n            .attr(\"y\", function(d) { return d.y; });\n        }\n\n        function weightRadius(d) {\n          var r = d.radius;\n          return r;\n        }\n\n        function zoomed() {\n            svg.attr('transform', 'translate(' + d3.event.transform.x + ',' + d3.event.transform.y + ') scale(' + d3.event.transform.k + ')');\n        }\n\n        function dragstarted(d) {\n            if (!d3.event.active) simulation.alphaTarget(0.3).restart();\n            d.fx = d.x;\n            d.fy = d.y;\n        }\n\n        function dragged(d) {\n            d.fx = d3.event.x;\n            d.fy = d3.event.y;\n        }\n\n        function dragended(d) {\n            if (!d3.event.active) simulation.alphaTarget(0);\n            d.fx = null;\n            d.fy = null;\n        }\n        \n      });\n\n  }\n\n  componentWillMount(){\n    this.fetchSystems()\n  }\n\n  componentDidUpdate(){\n    if(this.state.load_graph === false){\n      if(this.state.systems.length !== 0) this.buildForceGraph(this.state.systems);\n      this.setState({load_graph: true})\n    }\n    var activeSys = document.getElementById(\"graph_\"+this.props.activeSystem)\n    if(activeSys !== null){\n      var cols = document.getElementsByClassName('system');\n      for(var i = 0; i < cols.length; i++) {\n        cols[i].style.fill = '';\n      }\n      activeSys.setAttribute(\"style\", \"fill:#e8455c\");\n    }\n  }\n\n  render() {\n    return (\n      <div>\n        <div className=\"forcegraph\"></div>\n      </div>\n      \n    )\n  }\n}\n\nfunction mapStateToProps(state){\n  return{\n    activeSystem: state.activeSystem\n  }\n}\n\nexport default connect(mapStateToProps)(Graph);"]},"metadata":{},"sourceType":"module"}