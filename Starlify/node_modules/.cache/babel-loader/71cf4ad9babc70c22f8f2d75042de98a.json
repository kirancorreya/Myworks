{"ast":null,"code":"var _jsxFileName = \"/Users/kirancorreya/Site/Starlify/src/pages/dashboard/graph/Graph.js\";\nimport React, { Component } from 'react';\nimport * as d3 from 'd3';\nimport { connect } from 'react-redux';\n\nclass Graph extends Component {\n  constructor() {\n    super();\n\n    this.buildForceGraph = systems => {\n      let modelURL = this.props.modelUri;\n      new Promise(async function (resolve, reject) {\n        var items = [];\n        items[\"nodes\"] = [];\n        items[\"links\"] = [];\n\n        for (let i = 0; i < systems.length; i++) {\n          const system = systems[i];\n          items[\"nodes\"].push({\n            \"id\": system.id,\n            \"name\": system.name || \"System\",\n            \"type\": \"system\",\n            \"radius\": 15\n          });\n\n          if (system.services) {\n            for (let j = 0; j < system.services.length; j++) {\n              const service = system.services[j];\n              items[\"nodes\"].push({\n                \"id\": service.id,\n                name: service.name || \"Service\",\n                \"type\": \"service\",\n                \"radius\": 5\n              });\n              items[\"links\"].push({\n                \"source\": system.id,\n                \"target\": service.id,\n                \"type\": \"service\"\n              });\n            }\n          }\n\n          if (system.references) {\n            for (let x = 0; x < system.references.length; x++) {\n              const reference = system.references[x];\n              await fetch(process.env.REACT_APP_API + modelURL + \"/reference/\" + reference.id).then(res => res.json()).then(result => {\n                if (result.service !== undefined) {\n                  items[\"links\"].push({\n                    \"source\": system.id,\n                    \"target\": result.service.id,\n                    \"type\": \"reference\",\n                    \"id\": reference.id\n                  });\n                }\n              });\n            }\n          }\n        }\n\n        resolve(items);\n      }).then(function (items) {\n        const width = window.innerWidth,\n              height = window.innerHeight - 100;\n        const zoom = d3.zoom().scaleExtent([0.5, 6]).on(\"zoom\", zoomed);\n        var parent = d3.select(\".forcegraph\");\n        parent.selectAll(\"*\").remove();\n        var svg = parent.append(\"svg\").attr(\"width\", width).attr(\"height\", height).call(zoom).append(\"g\").attr(\"transform\", \"translate(0,0)\");\n        svg.append('defs').append('marker').attr('id', 'service').attr('viewBox', '-5 -5 20 20').attr('refX', 8).attr('refY', 0).attr('orient', 'auto').attr('markerWidth', 25).attr('markerHeight', 25).attr('xoverflow', 'visible').append('svg:path').attr('d', 'M -5 -2 L 0 0 L -5 2 z').attr('fill', '#fff').style('stroke', 'none');\n        var simulation = d3.forceSimulation().force(\"link\", d3.forceLink().id(function (d, i) {\n          return d.id;\n        }).distance(function (d) {\n          return d.type === \"reference\" ? 100 : 10;\n        })).force(\"charge\", d3.forceManyBody().strength(-250)).force('gravity', d3.forceRadial(0, 0)).force('x', d3.forceX().strength(0.01)).force('y', d3.forceY().strength(0.01)).force('collide', d3.forceCollide(0)).force(\"center\", d3.forceCenter(width / 2, height / 2));\n        var links = svg.selectAll(\".link\").data(items.links).enter().append(\"line\").attr(\"class\", \"link\");\n        var nodes = svg.selectAll(\".node\").data(items.nodes).enter().append(\"g\").attr(\"class\", \"node\").call(d3.drag().on(\"start\", dragstarted).on(\"drag\", dragged).on(\"end\", dragended));\n        var circle = nodes.append(\"circle\");\n        var label = nodes.append(\"text\").attr(\"dy\", \".35em\").attr(\"class\", function (d) {\n          return d.type;\n        }).text(function (d) {\n          return d.name;\n        });\n        simulation.nodes(items.nodes).on(\"tick\", tick);\n        simulation.force(\"link\").links(items.links);\n\n        function tick() {\n          links.attr(\"x1\", function (d) {\n            return d.source.x;\n          }).attr(\"y1\", function (d) {\n            return d.source.y;\n          }).attr(\"x2\", function (d) {\n            return d.target.x;\n          }).attr(\"y2\", function (d) {\n            return d.target.y;\n          }).attr(\"marker-end\", function (d) {\n            return d.type === \"reference\" ? \"url(#service)\" : \"\";\n          }).attr(\"id\", function (d) {\n            return \"link_\" + d.id;\n          }).attr(\"class\", function (d) {\n            return \"link \" + d.type;\n          });\n          circle.attr(\"id\", function (d) {\n            return \"graph_\" + d.id;\n          }).attr(\"cx\", function (d) {\n            return d.x;\n          }).attr(\"cy\", function (d) {\n            return d.y;\n          }).attr(\"class\", function (d) {\n            return d.type;\n          }).attr(\"r\", weightRadius);\n          label.attr(\"x\", function (d) {\n            return d.x;\n          }).attr(\"y\", function (d) {\n            return d.y;\n          });\n        }\n\n        function weightRadius(d) {\n          var r = d.radius;\n          return r;\n        }\n\n        function zoomed() {\n          svg.attr('transform', 'translate(' + d3.event.transform.x + ',' + d3.event.transform.y + ') scale(' + d3.event.transform.k + ')');\n        }\n\n        function dragstarted(d) {\n          if (!d3.event.active) simulation.alphaTarget(0.3).restart();\n          d.fx = d.x;\n          d.fy = d.y;\n        }\n\n        function dragged(d) {\n          d.fx = d3.event.x;\n          d.fy = d3.event.y;\n        }\n\n        function dragended(d) {\n          if (!d3.event.active) simulation.alphaTarget(0);\n          d.fx = null;\n          d.fy = null;\n        }\n      });\n    };\n\n    this.buildForceGraph = this.buildForceGraph.bind(this);\n    this.state = {\n      load_graph: false,\n      systems: []\n    };\n  }\n\n  componentDidUpdate() {\n    const _this$props = this.props,\n          systems = _this$props.systems,\n          type = _this$props.type;\n\n    switch (type) {\n      case \"SELECTDOMAIN\":\n        this.buildForceGraph([]);\n        break;\n\n      case \"FETCH_MODEL_SUCCESS\":\n        if (systems !== undefined) {\n          this.buildForceGraph(systems);\n        } else {\n          this.buildForceGraph([]);\n        }\n\n        break;\n\n      case \"FETCH_MODEL_FAILURE\":\n        this.buildForceGraph([]);\n        break;\n\n      case \"HIGHLIGHT_SYSTEM\":\n        var activeSys = document.getElementById(\"graph_\" + this.props.activeSystem);\n\n        if (activeSys !== null) {\n          let cols = document.getElementsByClassName('system');\n\n          for (let i = 0; i < cols.length; i++) {\n            cols[i].style.fill = '';\n          }\n\n          activeSys.setAttribute(\"style\", \"fill:#e8455c\");\n        }\n\n        break;\n\n      case \"HIGHLIGHT_SERVICE\":\n        var activeSrvc = document.getElementById(\"graph_\" + this.props.activeService);\n\n        if (activeSrvc !== null) {\n          let cols = document.getElementsByClassName('service');\n\n          for (let i = 0; i < cols.length; i++) {\n            cols[i].style.fill = '';\n          }\n\n          activeSrvc.setAttribute(\"style\", \"fill:#e8455c\");\n        }\n\n        break;\n\n      case \"HIGHLIGHT_REFERENCE\":\n        var activeRfrnc = document.getElementById(\"link_\" + this.props.activeReference);\n\n        if (activeRfrnc !== null) {\n          let cols = document.getElementsByClassName('reference');\n\n          for (let i = 0; i < cols.length; i++) {\n            cols[i].style.stroke = '';\n          }\n\n          activeRfrnc.setAttribute(\"style\", \"stroke:#e8455c\");\n        }\n\n        break;\n\n      default:\n        break;\n    }\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      className: \"forcegraph\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 242\n      },\n      __self: this\n    });\n  }\n\n}\n\nfunction mapStateToProps(state) {\n  return {\n    activeSystem: state.model.activeSystem,\n    activeService: state.model.activeService,\n    activeReference: state.model.activeReference,\n    modelUri: state.model.modelUri,\n    systems: state.model.items,\n    status: state.model.status,\n    type: state.model.type\n  };\n}\n\nexport default connect(mapStateToProps)(Graph);","map":{"version":3,"sources":["/Users/kirancorreya/Site/Starlify/src/pages/dashboard/graph/Graph.js"],"names":["React","Component","d3","connect","Graph","constructor","buildForceGraph","systems","modelURL","props","modelUri","Promise","resolve","reject","items","i","length","system","push","id","name","services","j","service","references","x","reference","fetch","process","env","REACT_APP_API","then","res","json","result","undefined","width","window","innerWidth","height","innerHeight","zoom","scaleExtent","on","zoomed","parent","select","selectAll","remove","svg","append","attr","call","style","simulation","forceSimulation","force","forceLink","d","distance","type","forceManyBody","strength","forceRadial","forceX","forceY","forceCollide","forceCenter","links","data","enter","nodes","drag","dragstarted","dragged","dragended","circle","label","text","tick","source","y","target","weightRadius","r","radius","event","transform","k","active","alphaTarget","restart","fx","fy","bind","state","load_graph","componentDidUpdate","activeSys","document","getElementById","activeSystem","cols","getElementsByClassName","fill","setAttribute","activeSrvc","activeService","activeRfrnc","activeReference","stroke","render","mapStateToProps","model","status"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport * as d3 from 'd3';\nimport { connect } from 'react-redux';\n\nclass Graph extends Component {\n\n  constructor(){\n    super();\n    this.buildForceGraph = this.buildForceGraph.bind(this);\n    this.state = {\n      load_graph: false,\n      systems: []\n    }\n  }\n\n  buildForceGraph = (systems) => {\n    let modelURL = this.props.modelUri;\n    new Promise(async function(resolve, reject) {\n        var items = [];\n        items[\"nodes\"] = [];\n        items[\"links\"] = [];\n\n        for (let i = 0; i < systems.length; i++) {\n          const system = systems[i];\n          items[\"nodes\"].push({ \"id\": system.id, \"name\": system.name  || \"System\", \"type\": \"system\", \"radius\": 15 });\n\n          if (system.services){\n            for (let j = 0; j < system.services.length; j++) {\n              const service = system.services[j];\n              items[\"nodes\"].push({ \"id\": service.id, name: service.name || \"Service\", \"type\": \"service\", \"radius\": 5 });\n              items[\"links\"].push({\"source\": system.id, \"target\": service.id, \"type\": \"service\"});\n\n            }\n          }\n\n          if (system.references){\n            for (let x = 0; x < system.references.length; x++) {\n              const reference = system.references[x];\n              await fetch(process.env.REACT_APP_API + modelURL + \"/reference/\" + reference.id)\n              .then(res => res.json())\n              .then((result) => {\n                if (result.service !== undefined) {\n                  items[\"links\"].push({\"source\": system.id, \"target\": result.service.id, \"type\": \"reference\", \"id\": reference.id});\n                }\n              })\n            }\n          }\n        }\n\n        resolve(items);\n\n      }).then(function(items) {\n        const width = window.innerWidth,\n          height = window.innerHeight - 100;\n\n        const zoom = d3.zoom()\n                    .scaleExtent([0.5, 6])\n                    .on(\"zoom\", zoomed);\n\n        var parent = d3.select(\".forcegraph\");\n        parent.selectAll(\"*\").remove();\n        var svg = parent.append(\"svg\")\n            .attr(\"width\", width)\n            .attr(\"height\", height)\n            .call(zoom)\n            .append(\"g\")\n            .attr(\"transform\", \"translate(0,0)\");\n\n          svg.append('defs').append('marker')\n            .attr('id', 'service')\n            .attr('viewBox', '-5 -5 20 20')\n            .attr('refX', 8)\n            .attr('refY', 0)\n            .attr('orient', 'auto')\n            .attr('markerWidth', 25)\n            .attr('markerHeight', 25)\n            .attr('xoverflow', 'visible')\n            .append('svg:path')\n            .attr('d', 'M -5 -2 L 0 0 L -5 2 z')\n            .attr('fill', '#fff')\n            .style('stroke','none');\n\n        var simulation = d3.forceSimulation()\n          .force(\"link\", d3.forceLink().id(function(d,i) {\n            return d.id;\n          })\n          .distance(function(d) {\n            return d.type === \"reference\" ? 100 : 10;\n          }))\n          .force(\"charge\", d3.forceManyBody().strength(-250 ))\n          .force('gravity', d3.forceRadial(0, 0))\n          .force('x', d3.forceX().strength(0.01))\n          .force('y', d3.forceY().strength(0.01))\n          .force('collide', d3.forceCollide(0))\n          .force(\"center\", d3.forceCenter(width / 2, height / 2));\n\n        var links = svg.selectAll(\".link\")\n          .data(items.links)\n          .enter().append(\"line\")\n          .attr(\"class\", \"link\");\n\n        var nodes = svg.selectAll(\".node\")\n          .data(items.nodes)\n          .enter().append(\"g\")\n          .attr(\"class\", \"node\")\n          .call(d3.drag()\n            .on(\"start\", dragstarted)\n            .on(\"drag\", dragged)\n            .on(\"end\", dragended)\n          );\n\n        var circle = nodes.append(\"circle\");\n\n        var label = nodes.append(\"text\")\n          .attr(\"dy\", \".35em\")\n          .attr(\"class\", function(d) { return d.type; })\n          .text(function(d) { return d.name; });\n\n        simulation\n          .nodes(items.nodes)\n          .on(\"tick\", tick);\n\n        simulation\n          .force(\"link\")\n          .links(items.links);\n\n        function tick() {\n          links\n            .attr(\"x1\", function (d) { return d.source.x; })\n            .attr(\"y1\", function (d) { return d.source.y; })\n            .attr(\"x2\", function (d) { return d.target.x; })\n            .attr(\"y2\", function (d) { return d.target.y; })\n            .attr(\"marker-end\", function(d) {\n              return d.type === \"reference\" ? \"url(#service)\" : \"\";\n            })\n            .attr(\"id\", function(d) { return \"link_\"+d.id; })\n            .attr(\"class\", function(d) { return \"link \"+d.type; });\n\n          circle\n            .attr(\"id\", function(d) { return \"graph_\"+d.id; })\n            .attr(\"cx\", function(d) { return d.x; })\n            .attr(\"cy\", function(d) { return d.y; })\n            .attr(\"class\", function(d) { return d.type; })\n            .attr(\"r\", weightRadius);\n\n          label\n            .attr(\"x\", function(d) { return d.x; })\n            .attr(\"y\", function(d) { return d.y; });\n        }\n\n        function weightRadius(d) {\n          var r = d.radius;\n          return r;\n        }\n\n        function zoomed() {\n            svg.attr('transform', 'translate(' + d3.event.transform.x + ',' + d3.event.transform.y + ') scale(' + d3.event.transform.k + ')');\n        }\n\n        function dragstarted(d) {\n            if (!d3.event.active) simulation.alphaTarget(0.3).restart();\n            d.fx = d.x;\n            d.fy = d.y;\n        }\n\n        function dragged(d) {\n            d.fx = d3.event.x;\n            d.fy = d3.event.y;\n        }\n\n        function dragended(d) {\n            if (!d3.event.active) simulation.alphaTarget(0);\n            d.fx = null;\n            d.fy = null;\n        }\n\n      });\n\n  }\n\n\n  componentDidUpdate(){\n\n    const { systems, type} = this.props;\n\n    switch (type) {\n\n      case \"SELECTDOMAIN\":\n          this.buildForceGraph([]);\n      break;\n      case \"FETCH_MODEL_SUCCESS\":\n        if(systems !== undefined){\n            this.buildForceGraph(systems)\n        }else{\n          this.buildForceGraph([]);\n        }\n      break;\n      case \"FETCH_MODEL_FAILURE\":\n          this.buildForceGraph([]);\n      break;\n\n      case \"HIGHLIGHT_SYSTEM\":\n        var activeSys = document.getElementById(\"graph_\"+this.props.activeSystem)\n        if(activeSys !== null){\n          let cols = document.getElementsByClassName('system');\n          for(let i = 0; i < cols.length; i++) {\n            cols[i].style.fill = '';\n          }\n          activeSys.setAttribute(\"style\", \"fill:#e8455c\");\n        }\n      break;\n\n      case \"HIGHLIGHT_SERVICE\":\n        var activeSrvc = document.getElementById(\"graph_\"+this.props.activeService)\n        if(activeSrvc !== null){\n          let cols = document.getElementsByClassName('service');\n          for(let i = 0; i < cols.length; i++) {\n            cols[i].style.fill = '';\n          }\n          activeSrvc.setAttribute(\"style\", \"fill:#e8455c\");\n        }\n      break;\n\n      case \"HIGHLIGHT_REFERENCE\":\n        var activeRfrnc = document.getElementById(\"link_\"+this.props.activeReference)\n        if(activeRfrnc !== null){\n          let cols = document.getElementsByClassName('reference');\n          for(let i = 0; i < cols.length; i++) {\n            cols[i].style.stroke = '';\n          }\n          activeRfrnc.setAttribute(\"style\", \"stroke:#e8455c\");\n        }\n      break;\n\n      default:\n        break;\n    }\n  }\n\n  render() {\n    return (\n        <div className=\"forcegraph\"></div>\n    )\n  }\n}\n\nfunction mapStateToProps(state){\n  return{\n    activeSystem: state.model.activeSystem,\n    activeService: state.model.activeService,\n    activeReference: state.model.activeReference,\n    modelUri: state.model.modelUri,\n    systems: state.model.items,\n    status: state.model.status,\n    type: state.model.type,\n  }\n}\n\nexport default connect(mapStateToProps)(Graph);\n"]},"metadata":{},"sourceType":"module"}