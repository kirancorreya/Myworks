{"ast":null,"code":"var _jsxFileName = \"/Users/kirancorreya/Site/Starlify/src/pages/dashboard/graph/Graph.js\";\nimport React, { Component } from 'react';\nimport * as d3 from 'd3';\nimport { connect } from 'react-redux';\nimport _ from 'underscore';\n\nclass Graph extends Component {\n  constructor() {\n    super();\n\n    this.buildForceGraph = systems => {\n      new Promise(async function (resolve, reject) {\n        var items = [];\n        items[\"nodes\"] = [];\n        items[\"links\"] = [];\n\n        for (let i = 0; i < systems.length; i++) {\n          const system = systems[i];\n          items[\"nodes\"].push({\n            \"id\": system.id,\n            \"name\": system.name || \"System\",\n            \"type\": \"system\",\n            \"radius\": 15\n          });\n\n          if (system.services) {\n            for (let j = 0; j < system.services.length; j++) {\n              const service = system.services[j];\n              items[\"nodes\"].push({\n                \"id\": service.id,\n                name: service.name || \"Service\",\n                \"type\": \"service\",\n                \"radius\": 5\n              });\n              items[\"links\"].push({\n                \"source\": system.id,\n                \"target\": service.id,\n                \"type\": \"service\"\n              });\n            }\n          }\n\n          if (system.references) {\n            for (let x = 0; x < system.references.length; x++) {\n              var reference = system.references[x];\n              var link = reference._links[0];\n\n              if (link && link.rel === \"TO\") {\n                items[\"links\"].push({\n                  \"source\": system.id,\n                  \"target\": link.params.id,\n                  \"type\": \"reference\",\n                  \"id\": reference.id\n                });\n              }\n            }\n          }\n\n          if (system.subsystems) {\n            var subsystems = system.subsystems;\n\n            for (var subkey in subsystems) {\n              if (subsystems.hasOwnProperty(subkey)) {\n                for (let x = 0; x < subsystems[subkey].length; x++) {\n                  var sub = subsystems[subkey][x];\n\n                  switch (sub.type) {\n                    case 'system':\n                      items[\"nodes\"].push({\n                        \"id\": subkey,\n                        name: sub.title || \"Subsystem\",\n                        \"type\": \"subsystem\",\n                        \"radius\": 10\n                      });\n                      items[\"links\"].push({\n                        \"source\": system.id,\n                        \"target\": subkey,\n                        \"type\": \"subsystem\"\n                      });\n                      break;\n\n                    case 'service':\n                      items[\"nodes\"].push({\n                        \"id\": sub.params.id,\n                        name: sub.title || \"Service\",\n                        \"type\": \"service\",\n                        \"radius\": 5\n                      });\n                      items[\"links\"].push({\n                        \"source\": subkey,\n                        \"target\": sub.params.id,\n                        \"type\": \"service\"\n                      });\n                      break;\n\n                    case 'reference':\n                      await fetch(process.env.REACT_APP_API + sub.uri).then(res => res.json()).then(subrefer => {\n                        if (subrefer) {\n                          var link = subrefer._links[0];\n\n                          if (link && link.rel === \"TO\") {\n                            items[\"links\"].push({\n                              \"source\": subkey,\n                              \"target\": link.params.id,\n                              \"type\": \"reference\",\n                              \"id\": subrefer.id\n                            });\n                          }\n                        }\n                      });\n                      break;\n\n                    default:\n                      break;\n                  }\n                }\n              }\n            }\n          }\n        }\n\n        resolve(items);\n      }).then(function (items) {\n        var centered = false;\n        var timer;\n        const width = window.innerWidth,\n              height = window.innerHeight;\n        const zoom = d3.zoom().scaleExtent([0.2, 6]).on(\"zoom\", zoomed);\n\n        function zoomed() {\n          g.attr('transform', d3.event.transform);\n        }\n\n        var parent = d3.select(\".forcegraph\");\n        parent.selectAll(\"*\").remove();\n        parent.call(zoom); //parent.on(\"click\", center)\n\n        var svg = parent.append(\"svg\").attr(\"width\", width).attr(\"height\", height) //.call(zoom)\n        .append(\"g\").attr(\"transform\", \"translate(0,0)\");\n        svg.append('defs').append('marker').attr('id', 'service').attr('viewBox', '-5 -5 20 20').attr('refX', 8).attr('refY', 0).attr('orient', 'auto').attr('markerWidth', 25).attr('markerHeight', 25).attr('xoverflow', 'visible').append('svg:path').attr('d', 'M -5 -2 L 0 0 L -5 2 z').attr('fill', '#fff').style('stroke', 'none');\n        const g = svg.append(\"g\"); // Reset camera, set position to center of screen with no zoom.\n        // Necessary if changing model after zoom or pan have been made in previosly shown model.\n\n        parent.call(zoom.transform, d3.zoomIdentity.translate(0, 0).scale(1));\n        var simulation = d3.forceSimulation().force(\"link\", d3.forceLink().id(d => d.id).distance(d => d.type === \"reference\" ? 100 : 10)).force(\"charge\", d3.forceManyBody().strength(-250)).force('gravity', d3.forceRadial(0, 0)).force('x', d3.forceX().strength(0.01)).force('y', d3.forceY().strength(0.01)).force('collide', d3.forceCollide(0)).force(\"center\", d3.forceCenter(width / 2, height / 2));\n        var links = g.selectAll(\".link\").data(items.links).enter().append(\"line\").attr(\"class\", \"link\");\n        var nodes = g.selectAll(\".node\").data(items.nodes).enter().append(\"g\").attr(\"class\", \"node\") //.on(\"click\", d => clicked(d))\n        .call(d3.drag().on(\"start\", dragstarted).on(\"drag\", dragged).on(\"end\", dragended));\n        var circle = nodes.append(\"circle\").attr(\"class\", d => d.type);\n        var label = nodes.append(\"text\").attr(\"dy\", \".35em\").attr(\"class\", d => d.type + \"_label\").text(d => d.name);\n        simulation.nodes(items.nodes).on(\"tick\", tick).on(\"end\", () => {\n          if (!centered && items.nodes.length) {\n            centered = true;\n            center();\n          }\n        });\n        simulation.force(\"link\").links(items.links);\n\n        function tick() {\n          if (!timer && items.nodes.length) {\n            timer = performance.now();\n          } else if (timer && performance.now() - timer > 4000 && !centered) {\n            centered = true;\n            center();\n          }\n\n          links.attr(\"x1\", function (d) {\n            return d.source.x;\n          }).attr(\"y1\", function (d) {\n            return d.source.y;\n          }).attr(\"x2\", function (d) {\n            return d.target.x;\n          }).attr(\"y2\", function (d) {\n            return d.target.y;\n          }).attr(\"marker-end\", function (d) {\n            return d.type === \"reference\" ? \"url(#service)\" : \"\";\n          }).attr(\"id\", function (d) {\n            return \"link_\" + d.id;\n          }).attr(\"class\", function (d) {\n            return \"link \" + d.type;\n          });\n          circle.attr(\"id\", function (d) {\n            return \"graph_\" + d.id;\n          }).attr(\"cx\", function (d) {\n            return d.x;\n          }).attr(\"cy\", function (d) {\n            return d.y;\n          }).attr(\"class\", function (d) {\n            return d.type;\n          }).attr(\"r\", d => d.radius);\n          label.attr(\"x\", function (d) {\n            return d.x;\n          }).attr(\"y\", function (d) {\n            return d.y;\n          });\n        }\n\n        function center() {\n          var t = getGraphCenter();\n          var identity = d3.zoomIdentity.translate(width / 2, height / 2).scale(t.k).translate(-t.x, -t.y);\n          parent.transition().duration(2500).call(zoom.transform, identity);\n        }\n\n        function getGraphCenter() {\n          var nodes = d3.selectAll('circle').data();\n          var range = {\n            x: {\n              min: d3.min(_.pluck(nodes, 'x')),\n              max: d3.max(_.pluck(nodes, 'x'))\n            },\n            y: {\n              min: d3.min(_.pluck(nodes, 'y')),\n              max: d3.max(_.pluck(nodes, 'y'))\n            },\n            rad: d3.max(_.pluck(nodes, \"radius\"))\n          };\n          var x = range.x.min + (range.x.max - range.x.min) / 2;\n          var y = range.y.min + (range.y.max - range.y.min) / 2;\n          var target = 0.8;\n          var k;\n          (range.x.max - range.x.min) / width > (range.y.max - range.y.min) / height ? k = target / ((range.x.max - range.x.min + range.rad * 2) / width) : k = target / ((range.y.max - range.y.min + range.rad * 2) / height);\n          return {\n            x,\n            y,\n            k\n          };\n        }\n\n        function dragstarted(d) {\n          if (!d3.event.active) simulation.alphaTarget(0.3).restart();\n          d.fx = d.x;\n          d.fy = d.y;\n        }\n\n        function dragged(d) {\n          d.fx = d3.event.x;\n          d.fy = d3.event.y;\n        }\n\n        function dragended(d) {\n          if (!d3.event.active) simulation.alphaTarget(0);\n          d.fx = null;\n          d.fy = null;\n        }\n      });\n    };\n\n    this.buildForceGraph = this.buildForceGraph.bind(this);\n    this.state = {\n      load_graph: false,\n      systems: []\n    };\n  }\n\n  componentDidUpdate() {\n    const _this$props = this.props,\n          systems = _this$props.systems,\n          systype = _this$props.systype,\n          type = _this$props.type;\n\n    switch (systype) {\n      case \"FETCH_SYSTEMS_SUCCESS\":\n        if (systems !== undefined) {\n          this.buildForceGraph(systems);\n        } else {\n          this.buildForceGraph([]);\n        }\n\n        break;\n\n      case \"FETCH_SYSTEMS_FAILURE\":\n        this.buildForceGraph([]);\n        break;\n\n      default:\n        break;\n    }\n\n    switch (type) {\n      case \"SELECTDOMAIN\":\n        this.buildForceGraph([]);\n        break;\n\n      case \"HIGHLIGHT_SYSTEM\":\n        var activeSys = document.getElementById(\"graph_\" + this.props.activeSystem);\n\n        if (activeSys !== null) {\n          let cols = document.querySelectorAll('.system,.subsystem');\n\n          for (let i = 0; i < cols.length; i++) {\n            cols[i].style.fill = '';\n          }\n\n          activeSys.setAttribute(\"style\", \"fill:#e8455c\");\n        }\n\n        break;\n\n      case \"HIGHLIGHT_SERVICE\":\n        var activeSrvc = document.getElementById(\"graph_\" + this.props.activeService);\n\n        if (activeSrvc !== null) {\n          let cols = document.getElementsByClassName('service');\n\n          for (let i = 0; i < cols.length; i++) {\n            cols[i].style.fill = '';\n          }\n\n          activeSrvc.setAttribute(\"style\", \"fill:#e8455c\");\n        }\n\n        break;\n\n      case \"HIGHLIGHT_REFERENCE\":\n        var activeRfrnc = document.getElementById(\"link_\" + this.props.activeReference);\n\n        if (activeRfrnc !== null) {\n          let cols = document.getElementsByClassName('reference');\n\n          for (let i = 0; i < cols.length; i++) {\n            cols[i].style.stroke = '';\n          }\n\n          activeRfrnc.setAttribute(\"style\", \"stroke:#e8455c\");\n        }\n\n        break;\n\n      default:\n        break;\n    }\n\n    this.props.clearPropsType();\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      className: \"forcegraph\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 328\n      },\n      __self: this\n    });\n  }\n\n}\n\nfunction mapStateToProps(state) {\n  return {\n    systems: state.systems.items,\n    activeSystem: state.model.activeSystem,\n    activeService: state.model.activeService,\n    activeReference: state.model.activeReference,\n    modelUri: state.model.modelUri,\n    status: state.model.status,\n    type: state.model.type,\n    systype: state.systems.type\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    clearPropsType: e => {\n      const action = {\n        type: \"CLEARPROPS\"\n      };\n      dispatch(action);\n    }\n  };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Graph);","map":{"version":3,"sources":["/Users/kirancorreya/Site/Starlify/src/pages/dashboard/graph/Graph.js"],"names":["React","Component","d3","connect","_","Graph","constructor","buildForceGraph","systems","Promise","resolve","reject","items","i","length","system","push","id","name","services","j","service","references","x","reference","link","_links","rel","params","subsystems","subkey","hasOwnProperty","sub","type","title","fetch","process","env","REACT_APP_API","uri","then","res","json","subrefer","centered","timer","width","window","innerWidth","height","innerHeight","zoom","scaleExtent","on","zoomed","g","attr","event","transform","parent","select","selectAll","remove","call","svg","append","style","zoomIdentity","translate","scale","simulation","forceSimulation","force","forceLink","d","distance","forceManyBody","strength","forceRadial","forceX","forceY","forceCollide","forceCenter","links","data","enter","nodes","drag","dragstarted","dragged","dragended","circle","label","text","tick","center","performance","now","source","y","target","radius","t","getGraphCenter","identity","k","transition","duration","range","min","pluck","max","rad","active","alphaTarget","restart","fx","fy","bind","state","load_graph","componentDidUpdate","props","systype","undefined","activeSys","document","getElementById","activeSystem","cols","querySelectorAll","fill","setAttribute","activeSrvc","activeService","getElementsByClassName","activeRfrnc","activeReference","stroke","clearPropsType","render","mapStateToProps","model","modelUri","status","mapDispatchToProps","dispatch","e","action"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport * as d3 from 'd3';\nimport { connect } from 'react-redux';\nimport _ from 'underscore';\n\nclass Graph extends Component {\n\n  constructor(){\n    super();\n    this.buildForceGraph = this.buildForceGraph.bind(this);\n    this.state = {\n      load_graph: false,\n      systems: []\n    }\n  }\n\n  buildForceGraph = (systems) => {\n    new Promise(async function(resolve, reject) {\n        var items = [];\n        items[\"nodes\"] = [];\n        items[\"links\"] = [];\n\n        for (let i = 0; i < systems.length; i++) {\n          const system = systems[i];\n          items[\"nodes\"].push({ \"id\": system.id, \"name\": system.name  || \"System\", \"type\": \"system\", \"radius\": 15 });\n\n          if (system.services){\n            for (let j = 0; j < system.services.length; j++) {\n              const service = system.services[j];\n              items[\"nodes\"].push({ \"id\": service.id, name: service.name || \"Service\", \"type\": \"service\", \"radius\": 5 });\n              items[\"links\"].push({\"source\": system.id, \"target\": service.id, \"type\": \"service\"});\n            }\n          }\n\n          if (system.references){\n            for (let x = 0; x < system.references.length; x++) {\n              var reference = system.references[x];\n              var link = reference._links[0];\n\n              if (link && link.rel === \"TO\") {\n                items[\"links\"].push({\"source\": system.id, \"target\": link.params.id, \"type\": \"reference\", \"id\": reference.id});\n              }\n            }\n          }\n\n          if (system.subsystems){\n            var subsystems = system.subsystems;\n            for (var subkey in subsystems) {\n                if (subsystems.hasOwnProperty(subkey)) {\n                    for (let x = 0; x < subsystems[subkey].length; x++) {\n                      var sub = subsystems[subkey][x];\n                      switch (sub.type) {\n                        case 'system':\n                          items[\"nodes\"].push({ \"id\": subkey, name: sub.title || \"Subsystem\", \"type\": \"subsystem\", \"radius\": 10 });\n                          items[\"links\"].push({\"source\": system.id, \"target\": subkey, \"type\": \"subsystem\"});\n                        break;\n\n                        case 'service':\n                          items[\"nodes\"].push({ \"id\": sub.params.id, name: sub.title || \"Service\", \"type\": \"service\", \"radius\": 5 });\n                          items[\"links\"].push({\"source\": subkey, \"target\": sub.params.id, \"type\": \"service\"});\n                        break;\n\n                        case 'reference':\n                          await fetch( process.env.REACT_APP_API + sub.uri )\n                          .then(res => res.json())\n                          .then(subrefer => {\n                            if (subrefer) {\n                              var link = subrefer._links[0];\n                              if (link && link.rel === \"TO\") {\n                                items[\"links\"].push({\"source\": subkey, \"target\": link.params.id, \"type\": \"reference\", \"id\": subrefer.id});\n                              }\n                            }\n                          });\n                        break;\n\n                        default:\n                        break;\n                      }\n                    }\n                }\n            }\n          }\n        }\n\n        resolve(items);\n\n      }).then(function(items) {\n\n        var centered = false;\n        var timer;\n        const width = window.innerWidth,\n              height = window.innerHeight;\n\n        const zoom = d3.zoom()\n          .scaleExtent([0.2, 6])\n          .on(\"zoom\", zoomed);\n\n        function zoomed() {\n          g.attr('transform', d3.event.transform)\n        }\n\n        var parent = d3.select(\".forcegraph\");\n        parent.selectAll(\"*\").remove();\n        parent.call(zoom)\n        //parent.on(\"click\", center)\n        var svg = parent.append(\"svg\")\n            .attr(\"width\", width)\n            .attr(\"height\", height)\n            //.call(zoom)\n            .append(\"g\")\n            .attr(\"transform\", \"translate(0,0)\");\n\n          svg.append('defs').append('marker')\n            .attr('id', 'service')\n            .attr('viewBox', '-5 -5 20 20')\n            .attr('refX', 8)\n            .attr('refY', 0)\n            .attr('orient', 'auto')\n            .attr('markerWidth', 25)\n            .attr('markerHeight', 25)\n            .attr('xoverflow', 'visible')\n            .append('svg:path')\n            .attr('d', 'M -5 -2 L 0 0 L -5 2 z')\n            .attr('fill', '#fff')\n            .style('stroke','none');\n\n        const g = svg.append(\"g\");\n\n        // Reset camera, set position to center of screen with no zoom.\n        // Necessary if changing model after zoom or pan have been made in previosly shown model.\n        parent.call(zoom.transform, d3.zoomIdentity.translate(0, 0).scale(1))\n\n        var simulation = d3.forceSimulation()\n          .force(\"link\", d3.forceLink().id(d => d.id)\n            .distance(d => d.type === \"reference\" ? 100 : 10))\n          .force(\"charge\", d3.forceManyBody().strength(-250 ))\n          .force('gravity', d3.forceRadial(0, 0))\n          .force('x', d3.forceX().strength(0.01))\n          .force('y', d3.forceY().strength(0.01))\n          .force('collide', d3.forceCollide(0))\n          .force(\"center\", d3.forceCenter(width / 2, height / 2));\n\n        var links = g.selectAll(\".link\")\n          .data(items.links)\n          .enter().append(\"line\")\n          .attr(\"class\", \"link\");\n\n        var nodes = g.selectAll(\".node\")\n          .data(items.nodes)\n          .enter().append(\"g\")\n          .attr(\"class\", \"node\")\n          //.on(\"click\", d => clicked(d))\n          .call(d3.drag()\n            .on(\"start\", dragstarted)\n            .on(\"drag\", dragged)\n            .on(\"end\", dragended)\n          );\n\n        var circle = nodes.append(\"circle\")\n          .attr(\"class\", d => d.type);\n\n        var label = nodes.append(\"text\")\n          .attr(\"dy\", \".35em\")\n          .attr(\"class\", d => d.type + \"_label\")\n          .text(d => d.name);\n\n        simulation\n          .nodes(items.nodes)\n          .on(\"tick\", tick)\n          .on(\"end\", () => {\n            if (!centered && items.nodes.length) {\n              centered = true;\n              center();\n            }\n          });\n\n        simulation\n          .force(\"link\")\n          .links(items.links);\n\n        function tick() {\n          if (!timer && items.nodes.length) {\n            timer = performance.now()\n          }\n          else if (timer && (performance.now() - timer) > 4000 && !centered){\n            centered = true;\n            center();\n          }\n\n          links\n            .attr(\"x1\", function (d) { return d.source.x; })\n            .attr(\"y1\", function (d) { return d.source.y; })\n            .attr(\"x2\", function (d) { return d.target.x; })\n            .attr(\"y2\", function (d) { return d.target.y; })\n            .attr(\"marker-end\", function(d) {\n              return d.type === \"reference\" ? \"url(#service)\" : \"\";\n            })\n            .attr(\"id\", function(d) { return \"link_\"+d.id; })\n            .attr(\"class\", function(d) { return \"link \"+d.type; });\n\n          circle\n            .attr(\"id\", function(d) { return \"graph_\"+d.id; })\n            .attr(\"cx\", function(d) { return d.x; })\n            .attr(\"cy\", function(d) { return d.y; })\n            .attr(\"class\", function(d) { return d.type; })\n            .attr(\"r\", d => d.radius);\n\n          label\n            .attr(\"x\", function(d) { return d.x; })\n            .attr(\"y\", function(d) { return d.y; });\n        }\n\n        function center() {\n          var t = getGraphCenter()\n          var identity = d3.zoomIdentity.translate(width / 2, height / 2).scale(t.k).translate(-t.x, -t.y)\n          parent.transition().duration(2500).call(\n            zoom.transform,\n            identity\n          );\n        }\n\n        function getGraphCenter() {\n          var nodes = d3.selectAll('circle').data()\n          var range = {\n            x: {min: d3.min(_.pluck(nodes, 'x')),\n                max: d3.max(_.pluck(nodes, 'x'))},\n            y: {min: d3.min(_.pluck(nodes, 'y')),\n                max: d3.max(_.pluck(nodes, 'y'))},\n            rad: d3.max(_.pluck(nodes, \"radius\"))\n          }\n          var x = range.x.min + ((range.x.max - range.x.min) / 2)\n          var y = range.y.min + ((range.y.max - range.y.min) / 2)\n          var target = 0.8;\n          var k;\n          ((range.x.max - range.x.min)/width) > ((range.y.max - range.y.min)/height) ?\n            k = (target/((range.x.max - range.x.min + range.rad*2)/width)) :\n            k = (target/((range.y.max - range.y.min + range.rad*2)/height));\n          return {x, y, k}\n        }\n\n        function dragstarted(d) {\n          if (!d3.event.active) simulation.alphaTarget(0.3).restart();\n          d.fx = d.x;\n          d.fy = d.y;\n        }\n\n        function dragged(d) {\n          d.fx = d3.event.x;\n          d.fy = d3.event.y;\n        }\n\n        function dragended(d) {\n          if (!d3.event.active) simulation.alphaTarget(0);\n          d.fx = null;\n          d.fy = null;\n        }\n\n      });\n\n  }\n\n\n  componentDidUpdate(){\n    const { systems, systype, type} = this.props;\n\n    switch (systype) {\n      case \"FETCH_SYSTEMS_SUCCESS\":\n        if(systems !== undefined){\n          this.buildForceGraph(systems)\n        }else{\n          this.buildForceGraph([]);\n        }\n      break;\n      case \"FETCH_SYSTEMS_FAILURE\":\n          this.buildForceGraph([]);\n      break;\n\n      default:\n      break;\n    }\n\n    switch (type) {\n      case \"SELECTDOMAIN\":\n          this.buildForceGraph([]);\n      break;\n\n      case \"HIGHLIGHT_SYSTEM\":\n        var activeSys = document.getElementById(\"graph_\"+this.props.activeSystem)\n        if(activeSys !== null){\n          let cols = document.querySelectorAll('.system,.subsystem');\n          for(let i = 0; i < cols.length; i++) {\n            cols[i].style.fill = '';\n          }\n          activeSys.setAttribute(\"style\", \"fill:#e8455c\");\n        }\n      break;\n\n      case \"HIGHLIGHT_SERVICE\":\n        var activeSrvc = document.getElementById(\"graph_\"+this.props.activeService)\n        if(activeSrvc !== null){\n          let cols = document.getElementsByClassName('service');\n          for(let i = 0; i < cols.length; i++) {\n            cols[i].style.fill = '';\n          }\n          activeSrvc.setAttribute(\"style\", \"fill:#e8455c\");\n        }\n      break;\n\n      case \"HIGHLIGHT_REFERENCE\":\n        var activeRfrnc = document.getElementById(\"link_\"+this.props.activeReference)\n        if(activeRfrnc !== null){\n          let cols = document.getElementsByClassName('reference');\n          for(let i = 0; i < cols.length; i++) {\n            cols[i].style.stroke = '';\n          }\n          activeRfrnc.setAttribute(\"style\", \"stroke:#e8455c\");\n        }\n      break;\n\n      default:\n        break;\n    }\n    this.props.clearPropsType();\n  }\n\n  render() {\n    return (\n        <div className=\"forcegraph\"></div>\n    )\n  }\n}\n\nfunction mapStateToProps(state){\n  return{\n    systems: state.systems.items,\n    activeSystem: state.model.activeSystem,\n    activeService: state.model.activeService,\n    activeReference: state.model.activeReference,\n    modelUri: state.model.modelUri,\n    status: state.model.status,\n    type: state.model.type,\n    systype: state.systems.type,\n  }\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    clearPropsType: e => {\n      const action = { type: \"CLEARPROPS\" };\n      dispatch(action);\n    }\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Graph);\n"]},"metadata":{},"sourceType":"module"}